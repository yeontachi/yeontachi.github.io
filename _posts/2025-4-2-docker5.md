---
layout: single
title: "[Docker] Docker5 - "-v" 옵션 사용 및 실습(Mysql)"
categories: Docker
tag: [Docker]
toc: true
---

## -v 옵션이란?
 도커에서 **-v** 옵션은 **컨테이너와 호스트 간에 디렉토리나 파일을 공유**할 수 있도록 해주는 **볼륨(Volume) 마운트 옵션**이다. 즉, **컨테이너 안에서 생성되거나 수정되는 파일을 호스트에 저장**하거나, **호스트에 있는 파일을 컨테이너에서 접근**할 수 있도록 해주는 기능이다.

### 기본 문법

```
docker run -v [호스트 디렉토리]:[컨테이너 디렉토리] [이미지명]

예시:
docker run -v /home/user/data:/app/data my-image
```

 이렇게 하면 컨테이너에서 /app/data 디렉토리에 접근하면 실제로는 /home/user/data와 연결돼서 데이터를 공유할 수 있다.

### 볼륨의 종류

**1. 호스트 볼륨(host volume)** : 위에서 설명한 것처럼 호스트의 특정 디렉토리를 컨테이너와 공유하는 방식이다.

**2. 도커 볼륨(docker managed volumme)** : 도커가 관리하는 이름 있는 볼륨을 사용하는 방식이다.

```bash
docker volume create mydata
docker run -v mydata:/app/data my-image
```

 mydata라는 이름의 볼륨이 자동으로 도커 내부에 생성되고, 컨테이너의 /app/data 와 연결된다.

### 주요 옵션 추가 예시

```bash
docker run -v /path:/path:ro my-image
```

 - **ro 옵션** : read-only. 컨테이너에서는 읽기만 가능, 수정 불가능

```bash
docker run -v myvolume:/data --name mycontainer ubuntu
```

 - 이름 있는 도커 볼륨 사용 예시

### 볼륨을 사용하는 이유?
 컨테이너는 기본적으로 비영속적(종료되면 데이터가 사라짐)이다. 볼륨을 사용하면 데이터를 영속적으로 저장이 가능하기 때문에 볼륨을 사용한다. 또한 호스트와 컨테이너 사이 파일 공유, 여러 컨테이너 간의 데이터 공유도 가능하다.

### 볼륨 관련 추가 명령어

```bash
# 현재 도커에 등록된 볼륨 보기
docker volume ls
```

```bash
# 특정 볼륨 정보 확인
docker volume inspect mydata
```

```bash
# 볼륨 삭제
docker volume rm mydata
```

## -v 옵션 실습 : Host와 Mysql 컨테이너들 간의 db 볼륨 공유해보기

- **실습 순서**
    - 1. Host 디렉토리 생성
    - 2. 첫 번째 Mysql 컨테이너 실행 + 볼륨 연결
    - 3. 테이블 생성 및 데이터 저장
    - 4. 두 번째 Mysql 컨테이너 실행 -> 같은 볼륨 연결
    - 5. 두 컨테이너 모두 종료 및 삭제
    - 6. 세 번째 컨테이너 실행(같은 볼륨 연결)

![Alt text](/assets/DKimages/HW2_HostDirectory.png)

![Alt text](/assets/DKimages/HW2_runVOL1.png)

![Alt text](/assets/DKimages/HW2_execVOL1.png)

![Alt text](/assets/DKimages/HW2_createdbtest.png)

![Alt text](/assets/DKimages/HW2_CheckHostDir.png)

![Alt text](/assets/DKimages/HW2_stopVOL1.png)

![Alt text](/assets/DKimages/HW2_runVOL2.png)

![Alt text](/assets/DKimages/HW2_showDBVOL2.png)

![Alt text](/assets/DKimages/HW2_delCONT.png)

![Alt text](/assets/DKimages/HW2_runVOL3.png)

![Alt text](/assets/DKimages/HW2_showDBVOL3.png)